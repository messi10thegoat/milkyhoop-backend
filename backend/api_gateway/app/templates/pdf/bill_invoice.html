<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Faktur {{ bill.invoice_number or '-' }}</title>
</head>
<body>
    <div class="invoice">
        <!-- Header -->
        <div class="header">
            <div class="title">FAKTUR PEMBELIAN</div>
            <div class="invoice-number">{{ bill.invoice_number or '-' }}</div>
        </div>

        <!-- Meta Info -->
        <div class="meta-section">
            <div class="vendor-info">
                <div class="label">Dari</div>
                <div class="vendor-name">{{ bill.vendor.name if bill.vendor else (bill.vendor_name or '-') }}</div>
                {% if bill.vendor and bill.vendor.address %}
                <div class="vendor-address">{{ bill.vendor.address }}</div>
                {% endif %}
            </div>

            <div class="invoice-meta">
                <table>
                    <tr>
                        <td class="label">Tanggal:</td>
                        <td>{{ bill.issue_date | date_id }}</td>
                    </tr>
                    <tr>
                        <td class="label">Jatuh Tempo:</td>
                        <td>{{ bill.due_date | date_id }}</td>
                    </tr>
                    {% if bill.ref_no %}
                    <tr>
                        <td class="label">Ref:</td>
                        <td>{{ bill.ref_no }}</td>
                    </tr>
                    {% endif %}
                    <tr>
                        <td class="label">Status:</td>
                        <td class="status-{{ bill.status }}">{{ status_label }}</td>
                    </tr>
                </table>
            </div>
        </div>

        <!-- Items Table -->
        <table class="items-table">
            <thead>
                <tr>
                    <th class="col-no">#</th>
                    <th class="col-item">Item</th>
                    <th class="col-qty">Qty</th>
                    <th class="col-price">Harga</th>
                    <th class="col-disc">Disk</th>
                    <th class="col-total">Jumlah</th>
                </tr>
            </thead>
            <tbody>
                {% for item in bill.items %}
                <tr>
                    <td class="col-no">{{ loop.index }}</td>
                    <td class="col-item">
                        {{ item.product_name or item.description or '-' }}
                        {% if item.batch_no %}
                        <br><span class="batch-info">Batch: {{ item.batch_no }}</span>
                        {% endif %}
                        {% if item.exp_date %}
                        <span class="batch-info"> Exp: {{ item.exp_date }}</span>
                        {% endif %}
                    </td>
                    <td class="col-qty text-right">{{ item.qty or item.quantity }} {{ item.unit or '' }}</td>
                    <td class="col-price text-right">{{ (item.price or item.unit_price) | currency }}</td>
                    <td class="col-disc text-right">{{ item.discount_percent | default(0) }}%</td>
                    <td class="col-total text-right">{{ (item.total or item.subtotal) | currency }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- Totals -->
        <div class="totals-section">
            <table class="totals-table">
                <tr>
                    <td class="label">Subtotal</td>
                    <td class="amount">Rp {{ bill.subtotal | currency }}</td>
                </tr>
                {% if bill.item_discount_total and bill.item_discount_total > 0 %}
                <tr>
                    <td class="label">Diskon Item</td>
                    <td class="amount">-Rp {{ bill.item_discount_total | currency }}</td>
                </tr>
                {% endif %}
                {% if bill.invoice_discount_total and bill.invoice_discount_total > 0 %}
                <tr>
                    <td class="label">Diskon Faktur</td>
                    <td class="amount">-Rp {{ bill.invoice_discount_total | currency }}</td>
                </tr>
                {% endif %}
                {% if bill.cash_discount_total and bill.cash_discount_total > 0 %}
                <tr>
                    <td class="label">Diskon Tunai</td>
                    <td class="amount">-Rp {{ bill.cash_discount_total | currency }}</td>
                </tr>
                {% endif %}
                {% if bill.tax_rate and bill.tax_rate > 0 %}
                <tr>
                    <td class="label">DPP</td>
                    <td class="amount">Rp {{ bill.dpp | currency }}</td>
                </tr>
                <tr>
                    <td class="label">PPN ({{ bill.tax_rate }}%)</td>
                    <td class="amount">Rp {{ bill.tax_amount | currency }}</td>
                </tr>
                {% endif %}
                <tr class="grand-total">
                    <td class="label">Total</td>
                    <td class="amount">Rp {{ (bill.amount or bill.grand_total) | currency }}</td>
                </tr>
                {% if bill.amount_paid and bill.amount_paid > 0 %}
                <tr>
                    <td class="label">Dibayar</td>
                    <td class="amount">Rp {{ bill.amount_paid | currency }}</td>
                </tr>
                <tr class="balance-due">
                    <td class="label">Sisa</td>
                    <td class="amount">Rp {{ bill.amount_due | currency }}</td>
                </tr>
                {% endif %}
            </table>
        </div>

        {% if bill.notes %}
        <div class="notes-section">
            <div class="label">Catatan</div>
            <div class="notes-content">{{ bill.notes }}</div>
        </div>
        {% endif %}

        <!-- Footer -->
        <div class="footer">
            <div class="generated-at">
                Dicetak: {{ generated_at | date_id }}
            </div>
        </div>
    </div>
</body>
</html>
