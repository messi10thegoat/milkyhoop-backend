"use strict";(self.webpackChunkmilkyhoop_frontend=self.webpackChunkmilkyhoop_frontend||[]).push([[308],{308:(e,t,s)=>{s.r(t),s.d(t,{default:()=>c});var a=s(43),r=s(216),n=s(860),l=s(688),o=s(979),i=s(579);const c=()=>{const e=(0,r.Zp)(),t=(0,r.zy)(),{tenantId:s}=(0,r.g)(),[c,d]=(0,a.useState)([]),[p,u]=(0,a.useState)(""),[x,m]=(0,a.useState)(!1),[h,f]=(0,a.useState)(!1),[g,b]=(0,a.useState)(!0),[w,y]=(0,a.useState)(!1),[j,v]=(0,a.useState)(null),k=(0,a.useRef)(null);(0,a.useEffect)(()=>{(()=>{var e;null===(e=k.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})})()},[c]),(0,a.useEffect)(()=>{(async()=>{if(s)try{const e=await fetch("/api/tenant/".concat(s,"/info"));if(e.ok){const t=await e.json();v(t.data)}}catch(e){console.error("Failed to fetch tenant info:",e)}})()},[s]),(0,a.useEffect)(()=>{(async()=>{if(s){if((0,n.wR)())try{const e=await(0,l.Fi)(s);f(e)}catch(e){console.error("Access check failed:",e),f(!1)}else f(!1);b(!1)}else b(!1)})()},[s]),(0,a.useEffect)(()=>{var e;const s=null===(e=t.state)||void 0===e?void 0:e.initialMessage;s&&!g&&N(s)},[t.state,g]);const N=async e=>{if(!e.trim()||x||!s)return;const t={id:Date.now().toString(),text:e,isUser:!0,timestamp:new Date};d(e=>[...e,t]),u(""),m(!0);try{let t;if(h)t=await(0,l.oQ)(s,e);else{const a=await fetch("/tenant/".concat(s,"/chat"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:e})});t=await a.json()}const a={id:(Date.now()+1).toString(),text:t.milky_response||t.message||"Maaf, terjadi kesalahan.",isUser:!1,timestamp:new Date};d(e=>[...e,a])}catch(a){console.error("Error sending message:",a);const e={id:(Date.now()+1).toString(),text:"Maaf, terjadi kesalahan. Silakan coba lagi.",isUser:!1,timestamp:new Date};d(t=>[...t,e])}finally{m(!1)}};return g?(0,i.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto mb-4"}),(0,i.jsx)("p",{className:"text-gray-600",children:"Loading..."})]})}):(0,i.jsxs)("div",{className:"flex flex-col h-screen bg-gray-50",children:[(0,i.jsx)("header",{className:"bg-white shadow-sm border-b",children:(0,i.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-4 flex items-center justify-between",children:[(0,i.jsx)("button",{onClick:()=>e("/".concat(s)),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:(0,i.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)("h1",{className:"text-xl font-bold",children:(null===j||void 0===j?void 0:j.display_name)||"Chat"}),h&&(0,i.jsx)("span",{className:"px-2 py-1 bg-purple-100 text-purple-700 text-xs font-semibold rounded-full",children:"Tenant Mode"})]}),h?(0,i.jsx)("button",{onClick:()=>{(0,n.ri)(),window.location.reload()},className:"px-4 py-2 bg-gray-600 text-white rounded-lg text-sm font-medium hover:bg-gray-700",children:"Logout"}):(0,i.jsx)("button",{onClick:()=>y(!0),className:"px-4 py-2 bg-purple-600 text-white rounded-lg text-sm font-medium hover:bg-purple-700",children:"Login"})]})}),h&&(0,i.jsx)("div",{className:"bg-purple-50 border-b border-purple-100 px-4 py-3",children:(0,i.jsxs)("div",{className:"max-w-4xl mx-auto flex items-center space-x-2 overflow-x-auto",children:[(0,i.jsx)("button",{onClick:()=>N("produk apa yang paling laku?"),className:"px-4 py-2 bg-white border border-purple-200 rounded-lg text-sm font-medium text-purple-700 hover:bg-purple-50 whitespace-nowrap",children:"\ud83d\udcca Top Products"}),(0,i.jsx)("button",{onClick:()=>N("produk mana yang kurang laku?"),className:"px-4 py-2 bg-white border border-purple-200 rounded-lg text-sm font-medium text-purple-700 hover:bg-purple-50 whitespace-nowrap",children:"\u26a0\ufe0f Low Sellers"}),(0,i.jsx)("button",{onClick:()=>N("cek stok ballpoint"),className:"px-4 py-2 bg-white border border-purple-200 rounded-lg text-sm font-medium text-purple-700 hover:bg-purple-50 whitespace-nowrap",children:"\ud83d\udce6 Check Stock"}),(0,i.jsx)("button",{onClick:()=>N("untung bulan ini berapa?"),className:"px-4 py-2 bg-white border border-purple-200 rounded-lg text-sm font-medium text-purple-700 hover:bg-purple-50 whitespace-nowrap",children:"\ud83d\udcb0 Monthly Profit"})]})}),(0,i.jsx)("div",{className:"flex-1 overflow-y-auto px-4 py-6",children:(0,i.jsxs)("div",{className:"max-w-4xl mx-auto space-y-4",children:[c.map(e=>(0,i.jsx)("div",{className:"flex ".concat(e.isUser?"justify-end":"justify-start"),children:(0,i.jsxs)("div",{className:"max-w-[80%] rounded-2xl px-4 py-3 ".concat(e.isUser?"bg-purple-600 text-white":"bg-white text-gray-800 shadow-sm"),children:[(0,i.jsx)("p",{className:"text-sm whitespace-pre-wrap",children:e.text}),(0,i.jsx)("p",{className:"text-xs mt-1 ".concat(e.isUser?"text-purple-200":"text-gray-400"),children:e.timestamp.toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"})})]})},e.id)),x&&(0,i.jsx)("div",{className:"flex justify-start",children:(0,i.jsx)("div",{className:"bg-white rounded-2xl px-4 py-3 shadow-sm",children:(0,i.jsxs)("div",{className:"flex space-x-2",children:[(0,i.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),(0,i.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),(0,i.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})})}),(0,i.jsx)("div",{ref:k})]})}),(0,i.jsx)("div",{className:"bg-white border-t p-4",children:(0,i.jsxs)("div",{className:"max-w-4xl mx-auto flex items-end space-x-3",children:[(0,i.jsx)("div",{className:"flex-1",children:(0,i.jsx)("textarea",{value:p,onChange:e=>u(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),N(p))},placeholder:"Ketik pesan Anda...",className:"w-full px-4 py-3 border border-gray-300 rounded-2xl resize-none focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent",rows:1,disabled:x})}),(0,i.jsx)("button",{onClick:()=>N(p),disabled:!p.trim()||x,className:"w-12 h-12 bg-purple-400 text-white rounded-full flex items-center justify-center hover:bg-purple-500 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors",children:(0,i.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})})]})}),(0,i.jsx)(o.A,{isOpen:w,onClose:()=>y(!1),onLoginSuccess:async()=>{if(y(!1),b(!0),s)try{const e=await(0,l.Fi)(s);f(e)}catch(e){console.error("Access check failed:",e),f(!1)}b(!1)}})]})}}}]);
//# sourceMappingURL=308.f2fd328a.chunk.js.map