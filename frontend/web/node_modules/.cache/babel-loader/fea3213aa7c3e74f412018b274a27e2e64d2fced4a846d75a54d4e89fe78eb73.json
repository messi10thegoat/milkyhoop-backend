{"ast":null,"code":"/**\n * Device Detection Utilities for QR Login System\n * Determines whether user is on desktop or mobile browser\n *//**\n * Check if current browser is desktop (not mobile)\n * Desktop users will use QR-only login\n * Mobile users can login with email/password\n */export const isDesktopBrowser=()=>{if(typeof window==='undefined')return true;const ua=navigator.userAgent.toLowerCase();const mobileKeywords=['android','webos','iphone','ipad','ipod','blackberry','iemobile','opera mini','mobile','tablet'];// Check if any mobile keyword exists in user agent\nconst isMobile=mobileKeywords.some(keyword=>ua.includes(keyword));// Also check screen width as fallback\nconst isSmallScreen=window.innerWidth<768;return!isMobile&&!isSmallScreen;};/**\n * Check if current browser is mobile\n */export const isMobileBrowser=()=>{return!isDesktopBrowser();};/**\n * Get device type string\n */export const getDeviceType=()=>{return isDesktopBrowser()?'desktop':'mobile';};/**\n * Generate a simple browser fingerprint for device identification\n */export const getBrowserFingerprint=()=>{var _navigator$hardwareCo;if(typeof window==='undefined')return'unknown';const components=[navigator.userAgent,navigator.language,window.screen.colorDepth.toString(),\"\".concat(window.screen.width,\"x\").concat(window.screen.height),new Date().getTimezoneOffset().toString(),((_navigator$hardwareCo=navigator.hardwareConcurrency)===null||_navigator$hardwareCo===void 0?void 0:_navigator$hardwareCo.toString())||'unknown'];// Simple hash function\nconst str=components.join('|');let hash=0;for(let i=0;i<str.length;i++){const char=str.charCodeAt(i);hash=(hash<<5)-hash+char;hash=hash&hash;}return Math.abs(hash).toString(36);};/**\n * Get human-readable device name\n */export const getDeviceName=()=>{const ua=navigator.userAgent;// Detect browser\nlet browser='Browser';if(ua.includes('Chrome')&&!ua.includes('Edg'))browser='Chrome';else if(ua.includes('Firefox'))browser='Firefox';else if(ua.includes('Safari')&&!ua.includes('Chrome'))browser='Safari';else if(ua.includes('Edg'))browser='Edge';// Detect OS\nlet os='Desktop';if(ua.includes('Windows'))os='Windows';else if(ua.includes('Mac'))os='Mac';else if(ua.includes('Linux'))os='Linux';else if(ua.includes('Android'))os='Android';else if(ua.includes('iPhone')||ua.includes('iPad'))os='iOS';return\"\".concat(browser,\" - \").concat(os);};/**\n * Get or create a unique Browser ID (stored in localStorage)\n *\n * This identifies the browser PROFILE, not the tab.\n * - Same browser profile (normal mode) = same browser_id\n * - Incognito/Private mode = different browser_id (new localStorage)\n * - Different browser = different browser_id\n *\n * Used for single session enforcement:\n * - 1 browser profile = 1 device = 1 active session\n */export const getBrowserId=()=>{if(typeof window==='undefined')return'ssr-default';const BROWSER_ID_KEY='milkyhoop_browser_id';let browserId=localStorage.getItem(BROWSER_ID_KEY);if(!browserId){// Generate unique browser ID using crypto API or fallback\nif(typeof crypto!=='undefined'&&crypto.randomUUID){browserId=crypto.randomUUID();}else{// Fallback for older browsers\nbrowserId=\"browser_\".concat(Date.now(),\"_\").concat(Math.random().toString(36).substring(2,15));}localStorage.setItem(BROWSER_ID_KEY,browserId);console.log('[Device] Created new browser_id:',browserId);}return browserId;};/**\n * Get or create a unique tab ID (stored in sessionStorage)\n *\n * Unlike browser_id which is shared across tabs (localStorage),\n * tab_id is unique per browser tab. This allows multiple tabs\n * to each have their own WebSocket connection for force logout.\n *\n * Why sessionStorage:\n * - Each tab has its own sessionStorage\n * - Survives page refreshes within the same tab\n * - Auto-cleared when tab is closed\n */export const getOrCreateTabId=()=>{if(typeof window==='undefined')return'ssr-default';const TAB_ID_KEY='milkyhoop_tab_id';let tabId=sessionStorage.getItem(TAB_ID_KEY);if(!tabId){// Generate unique tab ID: timestamp + random\ntabId=\"tab_\".concat(Date.now(),\"_\").concat(Math.random().toString(36).substring(2,9));sessionStorage.setItem(TAB_ID_KEY,tabId);console.log('[Device] Created new tab_id:',tabId);}return tabId;};","map":{"version":3,"names":["isDesktopBrowser","window","ua","navigator","userAgent","toLowerCase","mobileKeywords","isMobile","some","keyword","includes","isSmallScreen","innerWidth","isMobileBrowser","getDeviceType","getBrowserFingerprint","_navigator$hardwareCo","components","language","screen","colorDepth","toString","concat","width","height","Date","getTimezoneOffset","hardwareConcurrency","str","join","hash","i","length","char","charCodeAt","Math","abs","getDeviceName","browser","os","getBrowserId","BROWSER_ID_KEY","browserId","localStorage","getItem","crypto","randomUUID","now","random","substring","setItem","console","log","getOrCreateTabId","TAB_ID_KEY","tabId","sessionStorage"],"sources":["/root/milkyhoop-dev/frontend/web/src/utils/device.ts"],"sourcesContent":["/**\n * Device Detection Utilities for QR Login System\n * Determines whether user is on desktop or mobile browser\n */\n\n/**\n * Check if current browser is desktop (not mobile)\n * Desktop users will use QR-only login\n * Mobile users can login with email/password\n */\nexport const isDesktopBrowser = (): boolean => {\n  if (typeof window === 'undefined') return true;\n\n  const ua = navigator.userAgent.toLowerCase();\n  const mobileKeywords = [\n    'android',\n    'webos',\n    'iphone',\n    'ipad',\n    'ipod',\n    'blackberry',\n    'iemobile',\n    'opera mini',\n    'mobile',\n    'tablet'\n  ];\n\n  // Check if any mobile keyword exists in user agent\n  const isMobile = mobileKeywords.some(keyword => ua.includes(keyword));\n\n  // Also check screen width as fallback\n  const isSmallScreen = window.innerWidth < 768;\n\n  return !isMobile && !isSmallScreen;\n};\n\n/**\n * Check if current browser is mobile\n */\nexport const isMobileBrowser = (): boolean => {\n  return !isDesktopBrowser();\n};\n\n/**\n * Get device type string\n */\nexport const getDeviceType = (): 'desktop' | 'mobile' => {\n  return isDesktopBrowser() ? 'desktop' : 'mobile';\n};\n\n/**\n * Generate a simple browser fingerprint for device identification\n */\nexport const getBrowserFingerprint = (): string => {\n  if (typeof window === 'undefined') return 'unknown';\n\n  const components = [\n    navigator.userAgent,\n    navigator.language,\n    window.screen.colorDepth.toString(),\n    `${window.screen.width}x${window.screen.height}`,\n    new Date().getTimezoneOffset().toString(),\n    navigator.hardwareConcurrency?.toString() || 'unknown'\n  ];\n\n  // Simple hash function\n  const str = components.join('|');\n  let hash = 0;\n  for (let i = 0; i < str.length; i++) {\n    const char = str.charCodeAt(i);\n    hash = ((hash << 5) - hash) + char;\n    hash = hash & hash;\n  }\n\n  return Math.abs(hash).toString(36);\n};\n\n/**\n * Get human-readable device name\n */\nexport const getDeviceName = (): string => {\n  const ua = navigator.userAgent;\n\n  // Detect browser\n  let browser = 'Browser';\n  if (ua.includes('Chrome') && !ua.includes('Edg')) browser = 'Chrome';\n  else if (ua.includes('Firefox')) browser = 'Firefox';\n  else if (ua.includes('Safari') && !ua.includes('Chrome')) browser = 'Safari';\n  else if (ua.includes('Edg')) browser = 'Edge';\n\n  // Detect OS\n  let os = 'Desktop';\n  if (ua.includes('Windows')) os = 'Windows';\n  else if (ua.includes('Mac')) os = 'Mac';\n  else if (ua.includes('Linux')) os = 'Linux';\n  else if (ua.includes('Android')) os = 'Android';\n  else if (ua.includes('iPhone') || ua.includes('iPad')) os = 'iOS';\n\n  return `${browser} - ${os}`;\n};\n\n/**\n * Get or create a unique Browser ID (stored in localStorage)\n *\n * This identifies the browser PROFILE, not the tab.\n * - Same browser profile (normal mode) = same browser_id\n * - Incognito/Private mode = different browser_id (new localStorage)\n * - Different browser = different browser_id\n *\n * Used for single session enforcement:\n * - 1 browser profile = 1 device = 1 active session\n */\nexport const getBrowserId = (): string => {\n  if (typeof window === 'undefined') return 'ssr-default';\n\n  const BROWSER_ID_KEY = 'milkyhoop_browser_id';\n  let browserId = localStorage.getItem(BROWSER_ID_KEY);\n\n  if (!browserId) {\n    // Generate unique browser ID using crypto API or fallback\n    if (typeof crypto !== 'undefined' && crypto.randomUUID) {\n      browserId = crypto.randomUUID();\n    } else {\n      // Fallback for older browsers\n      browserId = `browser_${Date.now()}_${Math.random().toString(36).substring(2, 15)}`;\n    }\n    localStorage.setItem(BROWSER_ID_KEY, browserId);\n    console.log('[Device] Created new browser_id:', browserId);\n  }\n\n  return browserId;\n};\n\n/**\n * Get or create a unique tab ID (stored in sessionStorage)\n *\n * Unlike browser_id which is shared across tabs (localStorage),\n * tab_id is unique per browser tab. This allows multiple tabs\n * to each have their own WebSocket connection for force logout.\n *\n * Why sessionStorage:\n * - Each tab has its own sessionStorage\n * - Survives page refreshes within the same tab\n * - Auto-cleared when tab is closed\n */\nexport const getOrCreateTabId = (): string => {\n  if (typeof window === 'undefined') return 'ssr-default';\n\n  const TAB_ID_KEY = 'milkyhoop_tab_id';\n  let tabId = sessionStorage.getItem(TAB_ID_KEY);\n\n  if (!tabId) {\n    // Generate unique tab ID: timestamp + random\n    tabId = `tab_${Date.now()}_${Math.random().toString(36).substring(2, 9)}`;\n    sessionStorage.setItem(TAB_ID_KEY, tabId);\n    console.log('[Device] Created new tab_id:', tabId);\n  }\n\n  return tabId;\n};\n"],"mappings":"AAAA;AACA;AACA;AACA,GAEA;AACA;AACA;AACA;AACA,GACA,MAAO,MAAM,CAAAA,gBAAgB,CAAGA,CAAA,GAAe,CAC7C,GAAI,MAAO,CAAAC,MAAM,GAAK,WAAW,CAAE,MAAO,KAAI,CAE9C,KAAM,CAAAC,EAAE,CAAGC,SAAS,CAACC,SAAS,CAACC,WAAW,CAAC,CAAC,CAC5C,KAAM,CAAAC,cAAc,CAAG,CACrB,SAAS,CACT,OAAO,CACP,QAAQ,CACR,MAAM,CACN,MAAM,CACN,YAAY,CACZ,UAAU,CACV,YAAY,CACZ,QAAQ,CACR,QAAQ,CACT,CAED;AACA,KAAM,CAAAC,QAAQ,CAAGD,cAAc,CAACE,IAAI,CAACC,OAAO,EAAIP,EAAE,CAACQ,QAAQ,CAACD,OAAO,CAAC,CAAC,CAErE;AACA,KAAM,CAAAE,aAAa,CAAGV,MAAM,CAACW,UAAU,CAAG,GAAG,CAE7C,MAAO,CAACL,QAAQ,EAAI,CAACI,aAAa,CACpC,CAAC,CAED;AACA;AACA,GACA,MAAO,MAAM,CAAAE,eAAe,CAAGA,CAAA,GAAe,CAC5C,MAAO,CAACb,gBAAgB,CAAC,CAAC,CAC5B,CAAC,CAED;AACA;AACA,GACA,MAAO,MAAM,CAAAc,aAAa,CAAGA,CAAA,GAA4B,CACvD,MAAO,CAAAd,gBAAgB,CAAC,CAAC,CAAG,SAAS,CAAG,QAAQ,CAClD,CAAC,CAED;AACA;AACA,GACA,MAAO,MAAM,CAAAe,qBAAqB,CAAGA,CAAA,GAAc,KAAAC,qBAAA,CACjD,GAAI,MAAO,CAAAf,MAAM,GAAK,WAAW,CAAE,MAAO,SAAS,CAEnD,KAAM,CAAAgB,UAAU,CAAG,CACjBd,SAAS,CAACC,SAAS,CACnBD,SAAS,CAACe,QAAQ,CAClBjB,MAAM,CAACkB,MAAM,CAACC,UAAU,CAACC,QAAQ,CAAC,CAAC,IAAAC,MAAA,CAChCrB,MAAM,CAACkB,MAAM,CAACI,KAAK,MAAAD,MAAA,CAAIrB,MAAM,CAACkB,MAAM,CAACK,MAAM,EAC9C,GAAI,CAAAC,IAAI,CAAC,CAAC,CAACC,iBAAiB,CAAC,CAAC,CAACL,QAAQ,CAAC,CAAC,CACzC,EAAAL,qBAAA,CAAAb,SAAS,CAACwB,mBAAmB,UAAAX,qBAAA,iBAA7BA,qBAAA,CAA+BK,QAAQ,CAAC,CAAC,GAAI,SAAS,CACvD,CAED;AACA,KAAM,CAAAO,GAAG,CAAGX,UAAU,CAACY,IAAI,CAAC,GAAG,CAAC,CAChC,GAAI,CAAAC,IAAI,CAAG,CAAC,CACZ,IAAK,GAAI,CAAAC,CAAC,CAAG,CAAC,CAAEA,CAAC,CAAGH,GAAG,CAACI,MAAM,CAAED,CAAC,EAAE,CAAE,CACnC,KAAM,CAAAE,IAAI,CAAGL,GAAG,CAACM,UAAU,CAACH,CAAC,CAAC,CAC9BD,IAAI,CAAI,CAACA,IAAI,EAAI,CAAC,EAAIA,IAAI,CAAIG,IAAI,CAClCH,IAAI,CAAGA,IAAI,CAAGA,IAAI,CACpB,CAEA,MAAO,CAAAK,IAAI,CAACC,GAAG,CAACN,IAAI,CAAC,CAACT,QAAQ,CAAC,EAAE,CAAC,CACpC,CAAC,CAED;AACA;AACA,GACA,MAAO,MAAM,CAAAgB,aAAa,CAAGA,CAAA,GAAc,CACzC,KAAM,CAAAnC,EAAE,CAAGC,SAAS,CAACC,SAAS,CAE9B;AACA,GAAI,CAAAkC,OAAO,CAAG,SAAS,CACvB,GAAIpC,EAAE,CAACQ,QAAQ,CAAC,QAAQ,CAAC,EAAI,CAACR,EAAE,CAACQ,QAAQ,CAAC,KAAK,CAAC,CAAE4B,OAAO,CAAG,QAAQ,CAAC,IAChE,IAAIpC,EAAE,CAACQ,QAAQ,CAAC,SAAS,CAAC,CAAE4B,OAAO,CAAG,SAAS,CAAC,IAChD,IAAIpC,EAAE,CAACQ,QAAQ,CAAC,QAAQ,CAAC,EAAI,CAACR,EAAE,CAACQ,QAAQ,CAAC,QAAQ,CAAC,CAAE4B,OAAO,CAAG,QAAQ,CAAC,IACxE,IAAIpC,EAAE,CAACQ,QAAQ,CAAC,KAAK,CAAC,CAAE4B,OAAO,CAAG,MAAM,CAE7C;AACA,GAAI,CAAAC,EAAE,CAAG,SAAS,CAClB,GAAIrC,EAAE,CAACQ,QAAQ,CAAC,SAAS,CAAC,CAAE6B,EAAE,CAAG,SAAS,CAAC,IACtC,IAAIrC,EAAE,CAACQ,QAAQ,CAAC,KAAK,CAAC,CAAE6B,EAAE,CAAG,KAAK,CAAC,IACnC,IAAIrC,EAAE,CAACQ,QAAQ,CAAC,OAAO,CAAC,CAAE6B,EAAE,CAAG,OAAO,CAAC,IACvC,IAAIrC,EAAE,CAACQ,QAAQ,CAAC,SAAS,CAAC,CAAE6B,EAAE,CAAG,SAAS,CAAC,IAC3C,IAAIrC,EAAE,CAACQ,QAAQ,CAAC,QAAQ,CAAC,EAAIR,EAAE,CAACQ,QAAQ,CAAC,MAAM,CAAC,CAAE6B,EAAE,CAAG,KAAK,CAEjE,SAAAjB,MAAA,CAAUgB,OAAO,QAAAhB,MAAA,CAAMiB,EAAE,EAC3B,CAAC,CAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GACA,MAAO,MAAM,CAAAC,YAAY,CAAGA,CAAA,GAAc,CACxC,GAAI,MAAO,CAAAvC,MAAM,GAAK,WAAW,CAAE,MAAO,aAAa,CAEvD,KAAM,CAAAwC,cAAc,CAAG,sBAAsB,CAC7C,GAAI,CAAAC,SAAS,CAAGC,YAAY,CAACC,OAAO,CAACH,cAAc,CAAC,CAEpD,GAAI,CAACC,SAAS,CAAE,CACd;AACA,GAAI,MAAO,CAAAG,MAAM,GAAK,WAAW,EAAIA,MAAM,CAACC,UAAU,CAAE,CACtDJ,SAAS,CAAGG,MAAM,CAACC,UAAU,CAAC,CAAC,CACjC,CAAC,IAAM,CACL;AACAJ,SAAS,YAAApB,MAAA,CAAcG,IAAI,CAACsB,GAAG,CAAC,CAAC,MAAAzB,MAAA,CAAIa,IAAI,CAACa,MAAM,CAAC,CAAC,CAAC3B,QAAQ,CAAC,EAAE,CAAC,CAAC4B,SAAS,CAAC,CAAC,CAAE,EAAE,CAAC,CAAE,CACpF,CACAN,YAAY,CAACO,OAAO,CAACT,cAAc,CAAEC,SAAS,CAAC,CAC/CS,OAAO,CAACC,GAAG,CAAC,kCAAkC,CAAEV,SAAS,CAAC,CAC5D,CAEA,MAAO,CAAAA,SAAS,CAClB,CAAC,CAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GACA,MAAO,MAAM,CAAAW,gBAAgB,CAAGA,CAAA,GAAc,CAC5C,GAAI,MAAO,CAAApD,MAAM,GAAK,WAAW,CAAE,MAAO,aAAa,CAEvD,KAAM,CAAAqD,UAAU,CAAG,kBAAkB,CACrC,GAAI,CAAAC,KAAK,CAAGC,cAAc,CAACZ,OAAO,CAACU,UAAU,CAAC,CAE9C,GAAI,CAACC,KAAK,CAAE,CACV;AACAA,KAAK,QAAAjC,MAAA,CAAUG,IAAI,CAACsB,GAAG,CAAC,CAAC,MAAAzB,MAAA,CAAIa,IAAI,CAACa,MAAM,CAAC,CAAC,CAAC3B,QAAQ,CAAC,EAAE,CAAC,CAAC4B,SAAS,CAAC,CAAC,CAAE,CAAC,CAAC,CAAE,CACzEO,cAAc,CAACN,OAAO,CAACI,UAAU,CAAEC,KAAK,CAAC,CACzCJ,OAAO,CAACC,GAAG,CAAC,8BAA8B,CAAEG,KAAK,CAAC,CACpD,CAEA,MAAO,CAAAA,KAAK,CACd,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
